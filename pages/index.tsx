import type { GetServerSideProps } from 'next';
import Head from 'next/head';
import Link from 'next/link';
import Header from '../components/Header';
import components from '../styles/Home.module.css';
import checkUser, { UserData } from '../scripts/checkUser';
import ThemeChanger from '../components/ThemeChanger';

export const getServerSideProps: GetServerSideProps = async (context) => {
  const checkedUser = await checkUser(context);
  if (checkedUser.error || !checkedUser.data) {
    return {
      props: {
        loggedIn: false
      }
    }
  }
  return {
    props: {
      data: checkedUser.data,
      loggedIn: true
    }
  }
}

const Home = ({data, loggedIn}: { data?: UserData, loggedIn: boolean}) => {
  return (
    <>
      <Head>
        <title>Dashboard</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/dashboard.png" />
      </Head>
      <Header loggedIn={loggedIn} where='home'>Dashboard</Header>
      <main className={components.main}>
        <ThemeChanger />
        <h1 className={components.greeting}>Hello {data ? data.usersRName : "There"}</h1>
        <Link href="/search?query=test">Test</Link>
      </main>
    </>
  );
}

export default Home;
